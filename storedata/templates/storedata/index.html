<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë³´ë“œê²Œì„ í˜„í™© ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-screen flex">
  <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
  <aside class="w-1/5 bg-gray-100 p-4">
    <h2 class="text-xl font-bold mb-4">ì§€ì—­ ëª©ë¡</h2>
    <ul id="region-list" class="space-y-2"></ul>
  </aside>

  <!-- ì˜¤ë¥¸ìª½ ì½˜í…ì¸  -->
  <main class="w-4/5 p-6 space-y-6 overflow-auto">
    <h1 id="region-title" class="text-2xl font-bold"></h1>
    <section id="summary-box" class="bg-white shadow p-4 rounded">ìš”ì•½ ì •ë³´</section>
    <!--í¬ê¸° í‚¤ì›€-->
    <section class="flex gap-4 h-[300px]">
      <div id="chart-box" class="flex-1 bg-white shadow p-4 rounded">ì°¨íŠ¸ ìë¦¬</div>
      <div id="wordcloud-box" class="flex-1 bg-white shadow p-4 rounded">ì›Œë“œí´ë¼ìš°ë“œ ìë¦¬</div>
    </section>
    <section id="heatmap-box" class="bg-white shadow p-4 rounded h-[400px]">íˆíŠ¸ë§µ ìë¦¬</section>
    <section id="table-box" class="bg-white shadow p-4 rounded">í…Œì´ë¸” ìë¦¬</section>
  </main>

  <script>
    //ì§€ì—­ ê°€ì ¸ì˜¤ê¸°
    window.onload = () => {
      fetch('/api/regions/')
        .then(response => response.json())
        .then(regions => {
          const list = document.getElementById('region-list');
          list.innerHTML = '';
          regions.forEach(region => {
            const li = document.createElement('li');
            li.textContent = region;
            li.classList = 'cursor-pointer hover:text-blue-600 px-2 py-1';
            li.onclick = () => loadRegion(region);
            list.appendChild(li);
          });
        });
    };
    //í†µê³„ìš”ì•½
    function renderSummary(data, region) {
      document.getElementById('summary-box').innerHTML = `
        <p><strong>${region}</strong> í†µê³„ </p>
        <ul class="list-disc list-inside">
          <li>ì´ ì§€ì  ìˆ˜: ${data.store_count}</li>
          <li>ê³ ìœ  ë³´ë“œê²Œì„ ìˆ˜: ${data.unique_game_count}</li>
          <li>ì§€ì ë³„ í‰ê·  ë³´ìœ  ê²Œì„ ìˆ˜: ${data.average_owned}</li>
        </ul>
      `;
    }
    //ì°¨íŠ¸, ì›Œë“œí´ë¼ìš°ë“œ, íˆíŠ¸ë§µ
    function renderCharts(region) {
      document.getElementById('chart-box').innerHTML = `<img src="/static/charts/${region}.png" class="w-full h-full object-contain" alt="ì°¨íŠ¸">`;
      document.getElementById('wordcloud-box').innerHTML = `<img src="/static/wordclouds/${region}.png" alt="ì›Œë“œí´ë¼ìš°ë“œ">`;
      document.getElementById('heatmap-box').innerHTML = `<img src="/static/heatmaps/${region}.png" alt="íˆíŠ¸ë§µ">`;
    }
    //ì§€ì ë³„ ë³´ìœ ,ë¯¸ë³´ìœ 
    //ë²„íŠ¼, ìˆ¨ê¹€ë°•ìŠ¤
    function createToggleBlock(label, items, className, idx) {
      const btn = document.createElement('p');
      btn.textContent = `${label} ${items.length}ê°œ`;
      btn.className = className;

      const box = document.createElement('div');
      box.className = 'hidden mt-2 text-sm';
      box.innerHTML = `<p>${label === 'ë³´ìœ ' ? 'ğŸ“¦' : 'âŒ'} ${label}: ${items.join(', ')}</p>`;

      btn.addEventListener('click', () => box.classList.toggle('hidden'));

      return { btn, box };
    }
    //ê²Œì„ì¢…ë¥˜
    function renderStoreList(stores) {
      const tableBox = document.getElementById('table-box');
      tableBox.innerHTML = `<p>ì§€ì ë³„ ë³´ìœ /ë¯¸ë³´ìœ  ê²Œì„</p><ul id="store-list" class="space-y-2"></ul>`;
      //ì˜¤ë¥¸ìª½ ì•„ë˜ í…Œì´ë¸” ì˜ì—­ ë¹„ìš°ê³  ì´ˆê¸°í™”
      const storeList = document.getElementById('store-list');

      //ê° ì§€ì ë§ˆë‹¤ <li>, í…Œë‘ë¦¬, ì—¬ë°± ì ìš©
      stores.forEach((store, idx) => {
        const li = document.createElement('li');
        li.className = 'border p-2 rounded';
        //ì´ë¦„ êµµê²Œ
        const name = document.createElement('p');
        name.className = 'font-bold';
        name.textContent = store.name;
        //ë²„íŠ¼, ë°•ìŠ¤
        const { btn: ownedBtn, box: ownedBox } 
        = createToggleBlock('ë³´ìœ ', store.owned_list, 'cursor-pointer text-blue-600', idx);
        const { btn: missingBtn, box: missingBox } 
        = createToggleBlock('ë¯¸ë³´ìœ ', store.missing_list, 'cursor-pointer text-red-600 mt-2', idx);

        li.appendChild(name);
        li.appendChild(ownedBtn);
        li.appendChild(ownedBox);
        li.appendChild(missingBtn);
        li.appendChild(missingBox);
        storeList.appendChild(li);
      });
    }

    //ë”ë¯¸ë°ì´í„°
    function loadRegion(region) {
      const data = {
        store_count: 5,
        unique_game_count: 120,
        average_owned: 46.8,
        stores: [
          {
            name: 'ê°•ë‚¨ì ',
            owned_count: 50,
            missing_count: 10,
            owned_list: ['ì¹´íƒ„', 'í‹°ì¸„', 'ë£¨ë¯¸íë¸Œ'],
            missing_list: ['ë„ë¸”', 'ëŸ¬ë¸Œë ˆí„°']
          },
          {
            name: 'í™ëŒ€ì ',
            owned_count: 40,
            missing_count: 20,
            owned_list: ['ìŠ¤í”Œë Œë”', 'í‹°ì¼“íˆ¬ë¼ì´ë“œ'],
            missing_list: ['ì•„ë°œë¡ ', 'ì  ê°€']
          }
        ]
      };

      renderSummary(data, region);
      renderCharts(region);
      renderStoreList(data.stores);
      document.getElementById('region-title').textContent = `ì„ íƒí•œ ì§€ì—­: ${region}`;
    }
  </script>
</body>
</html>
